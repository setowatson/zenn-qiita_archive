---
title: "Databricksのマテリアライズドビュー解説"
emoji: "🌱"
type: "tech"
topics: ["databricks", "materialized-view", "データ基盤"]
published: false
publication_name: "headwaters"
---

# マテリアライズドビューとは？

マテリアライズドビュー（Materialized View, MV）とは、
**クエリ結果を物理的に保存し再利用することで、分析やアプリケーションの応答を高速化できる仕組み** です。

通常のビューと異なり、都度計算せずに事前計算されたデータを参照できるため、
大規模データや複雑な集計において大きな効果を発揮します。


## 通常のビューとの違い

| 項目       | 通常のビュー      | マテリアライズドビュー |
| -------- | ----------- | ----------- |
| データ保存    | しない（仮想テーブル） | する（物理テーブル）  |
| クエリ速度    | 元テーブルサイズに依存 | 事前集計で高速     |
| 更新タイミング  | 常に最新        | 定期/手動リフレッシュ |
| ストレージコスト | なし          | あり          |

**最新性重視ならビュー、性能重視ならマテリアライズドビュー** と整理すると実務で判断しやすいです。


## Databricksならではの特徴

* **Delta Lake連携**: MVもDeltaテーブルとして管理され、ACIDトランザクションやタイムトラベルが利用可能
* **自動リフレッシュ**: ジョブやSQL Warehouseで定期更新を自動化できる
* **分散処理の恩恵**: Sparkのスケーラブル処理により、数十億件規模の集計も効率的に更新可能
* **ガバナンス連携**: Unity Catalogで権限管理・監査ログを一元化できる

これにより、単なる「キャッシュ」ではなく、データ基盤の一部として信頼性を持って運用できる点が他のDWHと比べた優位性です。

---

## 実務での活用シーン

* **BIダッシュボードの最適化**: 朝一で開くと重いレポートをMVに変えることでユーザー体験を改善
* **定期レポート集計**: 日次/週次の売上サマリやKPIを事前計算して高速提供
* **特徴量テーブル管理**: MLモデルに供給する特徴量をMV化し、再利用と一貫性を担保
* **セキュリティ制御**: 元データを直接見せず、集約済みのMVを公開することで情報制御を強化

---

## 注意点

* **更新遅延**: リフレッシュしない限り古いデータのまま → 「ほぼリアルタイム」は不得意
* **ストレージコスト**: 大量・長期間保持でコスト増加 → 粒度と保持期間を設計時に明確化
* **スキーマ変更の影響**: 元テーブル変更がMVに波及するため、メンテナンス計画が必要
* **監視運用**: 自動リフレッシュの失敗検知やアラート仕組みが必須

---

## 作成・更新の例（SQL）

```sql
-- マテリアライズドビュー作成
CREATE MATERIALIZED VIEW sales_summary AS
SELECT region, SUM(amount) AS total_sales, COUNT(*) AS num_orders
FROM sales
GROUP BY region;

-- 手動でリフレッシュ
REFRESH MATERIALIZED VIEW sales_summary;
```

Databricksではこれをノートブックやジョブに組み込み、日次更新を完全自動化するのが一般的です。

---

## まとめ

Databricksのマテリアライズドビューは、**パフォーマンス改善**と**運用の信頼性**を両立できる強力な仕組みです。特にBIや定期レポート、特徴量管理といった実務ユースケースで威力を発揮します。ビューと使い分けながら導入することで、Databricks基盤の価値をさらに引き出せます。
